# 実践課題03: 発展的なSQLクエリ - 課題

## 指示

以下の10個の課題を解いてください。各課題に対して単一のSQLクエリを作成してください。

### 課題

1.  **（UNION ALLと基本的な集計）**
    店舗売上とオンライン売上を合算し、全体の売上合計額と販売数量合計を計算してください。

2.  **（LEFT JOINとNULL）**
    店舗またはオンラインで一度も商品を購入したことがない顧客をすべて見つけてください。顧客IDと顧客名を表示してください。

3.  **（CASEと集計）**
    売上額に基づいて、売上を「高」（10000円以上）、「中」（5000円以上）、「低」（5000円未満）の3つのカテゴリに分類してください。店舗売上とオンライン売上を合算した各カテゴリの売上件数をカウントしてください。

4.  **（自己結合）**
    各従業員について、その従業員の名前と直属のマネージャーの名前を一覧表示してください。マネージャーがいない従業員の場合は、マネージャー名として「N/A」と表示してください。

5.  **（WHERE句のサブクエリ）**
    「2022-01-01」以降に採用された従業員による売上をすべて見つけてください。

6.  **（ウィンドウ関数：RANK）**
    商品カテゴリごとに、店舗とオンラインの売上を合算した総売上額に基づいて商品をランク付けしてください。各カテゴリで最も売上が高い商品のランクは1となるようにしてください。

7.  **（CTEと複数JOIN）**
    共通テーブル式（CTE）を使い、店舗売上とオンライン売上を1つのテーブルとして合算してください。その後、この合算テーブルを用いて都道府県ごとの総売上額を集計してください。

8.  **（FROM句のサブクエリ）**
    まず、顧客ごとの総売上額を含む派生テーブルを作成してください。次に、このテーブルを`customers`テーブルと結合して、総売上額が最も高い顧客の名前を見つけてください。

9.  **（ウィンドウ関数：SUM OVER）**
    各店舗の売上について、時間経過（`sale_date`に基づく）に伴う累積売上額を計算してください。結果には、各店舗の`sale_date`、その日の売上額、およびその日までの累積売上額を表示してください。

10. **（複数の機能を使った複雑なクエリ）**
    各商品カテゴリにおいて、男女（`gender`）のうち総購入額が高い方の性別と、その総額を求めてください。